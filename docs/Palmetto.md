# KINC Usage Instructions on Palmetto

1) Ensure the GEM you intend to process is in the correct format, read as a `.txt` file

2) If you have previously used any version of KINC or ACE, be sure to remove the modules from your libraries. Furthermore, check to make sure that your `.bashrc` is clear of any designated paths for ACE or KINC.

3) Run the following 2 commands:

```
cp /zfs/feltus/btsheal/install-ace.sh /home/$USER
cp /zfs/feltus/btsheal/install-kinc.sh /home/$USER
```

4) Obtain an interactive node with at least 8 cores. Run the command:

```
qsub -I -l select=1:ncpus=8
```

5) Once you have obtained an interactive node, run the following 2 commands from your home directory:

```
./install-ace.sh
./install-kinc.sh
```

These scripts will install ACE and KINC into your home directory, establishing them as modules that can be run from anywhere. It will also rewrite all necessary path directions so that the modules can be called when necessary. It will create a module called `use.own`, which when added will make KINC and ACE available to be used interactively. For the purposes of running KINC to create a network this should not be necessary but might be useful to familiarize yourself with. You can now exit the interactive node.

6) Once ACE and KINC have been installed, run the following command:

```
cp /zfs/feltus/mrbende/run_KINC.sh /home/$USER
```

`run_KINC.sh` will take a GEM .txt file, and output the following:
- `.emx`: expression matrix
- `.ccm`: cluster composition matrix
- `.cmx`: correlation matrix
- `.log`: this is the log file, containing the threshold value generated by rmt
- `.o*`: this is the output file, check for errors at runtime
- `-net.txt`: this is the network, the product of KINC

7) Due to the high volume of data being written and read during the process of the job, it is important to run KINC from a scratch directory. Run the following two commands to ensure the files are accessible to KINC

```
cp /home/$USER/<name of GEM.txt> /scratch2/$USER
cp /home/$USER/run_KINC.sh /scratch2/$USER
```

KINC will read from the directory you launch from, so you only need a GEM and the run script in scratch.

8) Navigate into your scratch2 directory so that the GEM and run script are visible when you run `ls`.

9) KINC is now ready to be run from scratch2. It requires two arguments to run:

- The name of your input GEM (e.g. `EDS1014_GEM.txt`)
- The name you would like for your output files. The script will add the necessary file extensions. The following command will pass these variables to `qsub`:

```
qsub -v GEM=EDS1014_GEM.txt,OUTNAME=EDS1014 run_KINc.sh
```

The `GEM` variable should be set to the name of your GEM as it is written in scratch2. The `OUTNAME` variable should be set to what you would like your output files to be named, apart from the filename extensions. The job will then be submitted according to the allotted resource specifications of the script.

10) Once the job has finished, all 6 output files should be in your scratch2 directory. Check the last line of the log file to see the final threshold value, and check the output file to ensure there are no errors. The one CUDA error that appears at the top is noise and can be ignored.

11) The resulting network file can be visualized using [BioDepVis](https://github.com/SystemsGenetics/BioDepVis.git) or Cytoscape.
